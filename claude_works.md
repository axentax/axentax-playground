# UX改善: 初回プレイボタンクリック時のシンセ初期化

## 現状の実装分析

### 現在のオーバーレイ方式
- `layout-console.tsx:66-73`: エディタ読み込み後にオーバーレイ表示
- `step-overlay.tsx:26-33`: ユーザークリックでシンセ初期化開始
- `x-synth.ts:34-44`: `XSynth.init()`でクリックイベントリスナー登録
- `x-synth.ts:59-71`: 初回クリック時に`XSynthInitializer.init()`実行

### 問題点
- ユーザーがオーバーレイをクリックしないとシンセが初期化されない
- プレイボタンが表示されているが、クリックしても動作しない状態がある
- ワンクッション置く必要があり、UXが悪い

## UX改善案

### 基本方針
初回プレイボタンクリック時にシンセを初期化し、初期化完了後に自動的に再生開始する

## 修正点リスト

### 1. オーバーレイ表示制御の変更
**ファイル**: `src/features/layout-console/layout-console.tsx:66-73`
- オーバーレイレベル1の表示条件を削除
- エディタマウント後はオーバーレイを表示せず、直接レベル3(完了)に移行

### 2. プレイボタンクリック時のシンセ初期化
**ファイル**: `src/hooks/use-play-observer.ts:27-81`
- `playCB`関数の先頭でシンセ初期化状態をチェック
- 未初期化の場合は`XSynth.initForListener()`を呼び出し
- **重要**: `XSynthInitializer.init()`の非同期処理完了を`await`で待機
- 初期化完了後に通常の再生処理を実行

### 3. シンセ初期化状態の管理
**ファイル**: `src/synth/x-synth.ts`
- シンセ初期化状態を返すメソッド`isInitialized()`を追加
- 初期化中状態を管理するフラグを追加
- `initForListener()`をPromiseを返すように変更して`await`可能にする

### 4. 初期化中UI表示
**ファイル**: `src/features/layout-control/control-button.tsx:65-93`
- シンセ初期化中は専用のローディング表示（プレイボタン内でスピナー表示）
- 初期化完了まで他のボタンを無効化
- オーバーレイではなく、ボタン内表示で操作性を保持

### 5. エラーハンドリング強化
- シンセ初期化失敗時の適切なエラー表示
- ブラウザの自動再生ポリシーによる制限への対応

## 実装の流れ

1. ユーザーが初回プレイボタンをクリック
2. シンセが未初期化の場合、初期化処理を開始
3. 初期化中はローディング表示（プレイボタン内スピナー）
4. **初期化の非同期処理完了を待機**
5. 初期化完了後、自動的に再生開始
6. 2回目以降は通常の再生処理

## メリット

- オーバーレイクリックの手間を削減
- より直感的なUX
- プレイボタンをクリックすれば音が鳴る期待に応える
- 初期化処理がユーザーに見えにくくなる